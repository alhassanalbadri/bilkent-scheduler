name: Scrape Latest Courses

on:
  schedule:
    - cron: 0 0 1 * *
    - cron: 0 0 16 * *

  workflow_dispatch:
    inputs:
      logLevel:
        description: "Reason"
        required: true
        default: "warning"

  workflow_call: {}

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repo
        uses: actions/checkout@master
      - name: Add Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      - name: Scrape Courses
        run: |
          pip install requests beautifulsoup4
          python ./scrapers/fetch-courses.py
      - name: "Run Schedule Scraper if coures have been Changed"
        if: steps.auto-commit-action.outputs.changes_detected == 'true'
        run: python ./scrapers/fetch-schedule.py
      - name: Get Time
        id: time
        uses: nanzm/get-time-action@v1.1
        with:
          format: "DD-MM-YYYY"
      - name: Commit Back Changed Data
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "Latest courses data: ${{ steps.time.outputs.time }}"
          commit_author: Author <actions@github.com>
          file_pattern: data/*.json
